<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; }
        .user-container { margin: 10px; padding: 10px; border: 1px solid #ccc; }
        .user-field { margin: 5px 0; }
        button { margin: 5px 0; }
    </style>
</head>
<body>
    <h1>Admin Dashboard</h1>
    
    <!-- Search bar to filter users -->
    <input type="text" id="searchBar" placeholder="Search by username or ID" onkeyup="searchUsers()" />
    <div id="userList"></div>

    <script>
        let allUsers = []; // To store the original list of users

        // Fetch users from backend
        async function fetchUsers() {
            const response = await fetch("https://telegram-bot-degen-town.replit.app/admin/users", {
                headers: { "Authorization": "Basic " + btoa("admin:admin") }
            });
            allUsers = await response.json();
            renderUsers(allUsers);
        }

        // Render users based on the search result
        function renderUsers(users) {
            const userList = document.getElementById("userList");
            userList.innerHTML = ""; // Clear existing users

            users.forEach(user => {
                const userContainer = document.createElement("div");
                userContainer.classList.add("user-container");

                userContainer.innerHTML = `
                    <div class="user-field">User ID: ${user.userId}</div>
                    <div class="user-field">Username: ${user.username}</div>
                    <label>Commission Earned: 
                        <input type="number" value="${user.commissionEarned}" id="commissionEarned-${user.userId}" />
                    </label>
                    <label>Commission Paid: 
                        <input type="number" value="${user.commissionPaid}" id="commissionPaid-${user.userId}" />
                    </label>
                    <button onclick="updateUser('${user.userId}')">Update User</button>
                `;
                userList.appendChild(userContainer);
            });
        }

        // Filter users based on search query
        function searchUsers() {
            const query = document.getElementById("searchBar").value.toLowerCase();
            const filteredUsers = allUsers.filter(user => 
                user.username.toLowerCase().includes(query) || user.userId.includes(query)
            );
            renderUsers(filteredUsers);
        }

        // Update user information
        async function updateUser(userId) {
            const commissionEarned = document.getElementById(`commissionEarned-${userId}`).value;
            const commissionPaid = document.getElementById(`commissionPaid-${userId}`).value;

            const response = await fetch(`https://telegram-bot-degen-town.replit.app/admin/users/${userId}`, {
                method: "PUT",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": "Basic " + btoa("admin:admin")
                },
                body: JSON.stringify({ commissionEarned, commissionPaid })
            });

            if (response.ok) {
                alert("User updated successfully!");
                fetchUsers(); // Refresh the list
            } else {
                alert("Failed to update user.");
            }
        }

        // Fetch users on page load
        fetchUsers();
    </script>
</body>
</html>
