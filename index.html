<!DOCTYPE html>
<html lang="en" style="scrollbar-width: none !important;">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="mobile-web-app-capable" content="yes">
<meta http-equiv="Permissions-Policy" content="clipboard-write=(self)">
<meta name="apple-mobile-web-app-capable" content="yes">
    <title></title>
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcodasync function displayWallet() {
    const userId = Telegram.WebApp.initDataUnsafe.user.id; // Make sure user ID is valid

    try {
        const response = await fetch('https://telegram-bot-degen-town.replit.app/api/getWalletAddress', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ userId })
        });

        if (!response.ok) {
            throw new Error('Network response was not ok ' + response.statusText);
        }

        const data = await response.json();
        document.getElementById("wallet-address").textContent = truncateAddress(data.walletAddress);
    } catch (error) {
        console.error("Error fetching wallet address:", error);
        document.getElementById("wallet-address").textContent = "Error fetching wallet address.";
    }
}
e.min.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
        <script src="https://telegram.org/js/telegram-web-app.js"></script>
        <script type="text/javascript">
            
            window.Telegram.WebApp.ready(); window.Telegram.WebApp.expand();
        </script>
    <script src="js/qrcode.js"></script>
<script>
document.addEventListener("DOMContentLoaded", async function() {
    const userId = Telegram.WebApp.initDataUnsafe.user.id;

    // Fetch user referral data from the API
    async function fetchReferralData(userId) {
        try {
            const response = await fetch(`https://telegram-bot-degen-town.replit.app/api/user/referrals/${userId}`);
            if (!response.ok) throw new Error("Error fetching data");

            const userData = await response.json();
            document.getElementById("referrals-count").textContent = userData.totalReferrals || 0;
            document.getElementById("points-earned").textContent = userData.totalPoints || 0;

            const referralList = document.getElementById("referral-list");

            if (userData.referrals.length === 0) {
                // Display "No Referrals Available" message
                const noReferralsMessage = document.createElement("li");
                noReferralsMessage.textContent = "No Referrals Available";
                noReferralsMessage.style.textAlign = "center";
                noReferralsMessage.style.padding = "10px";
                referralList.appendChild(noReferralsMessage);
            } else {
                // Display referral details in table
                userData.referrals.forEach(referral => {
                    const listItem = document.createElement("tr");

                    const usernameCell = document.createElement("td");
                    const levelCell = document.createElement("td");
                    const pointsCell = document.createElement("td");

                    usernameCell.textContent = referral.username;
                    levelCell.textContent = getReferralLevel(referral.totalReferrals);
                    pointsCell.textContent = referral.totalPoints;

                    listItem.appendChild(usernameCell);
                    listItem.appendChild(levelCell);
                    listItem.appendChild(pointsCell);

                    referralList.appendChild(listItem);
                });
            }

        } catch (error) {
            console.error("Failed to fetch referral data:", error);
        }
    }

    await fetchReferralData(userId);
});

// Function to get the referral level
function getReferralLevel(totalReferrals) {
    if (totalReferrals >= 50) return 6;
    if (totalReferrals >= 20) return 5;
    if (totalReferrals >= 15) return 4;
    if (totalReferrals >= 10) return 3;
    if (totalReferrals >= 3) return 2;
    return 1; // Level 1 for 0 to 2 referrals
}


// Copy function for the referral link
function copyLink() {
    const referralLink = document.getElementById('referral-link').textContent;
    navigator.clipboard.writeText(referralLink).then(() => {}).catch(err => console.error('Could not copy text: ', err));
}
</script>
    <script src="js/qrcode.min.js"></script>
    <style>
@import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap');

        body, html {
      background-image: url("assets/img/background_screen_overlay.png");
      background-size: cover;
      background-repeat: no-repeat;
      background-attachment: fixed; /* Optional: keeps the background fixed */
      background-position: center center;
      margin: 0;
      padding: 0;
    height: 100%;
            font-weight: 400;
            color: white !important;
    font-family: 'Roboto', sans-serif;
    
        }

        /* Container for the page content */
        .content {
            height: calc(100% - 60px); /* Adjusting height for the app bar */
        }

        /* Content sections */
        .page {
            display: none;
            padding: 20px;
        }

        .active {
            display: block;

        }

        /* Fixed app bar at the bottom */
        .app-bar {
position: fixed;
    bottom: 0;
    width: 100%;
    height: 70px;
    background: url(assets/img/bottombanner.png);
    display: flex;
    justify-content: space-around;
    align-items: center;
    color: white;
    background-size: 100% 100%;
        }

        .app-bar button {
background-color: transparent;
    border: none;
    color: #d6d5da;
    font-size: 14px;
    cursor: pointer;
    outline: none;
    display: flex;
    flex-direction: column;
    align-items: center;
font-family: 'Roboto', sans-serif;
    font-weight: bold;
        }

        .app-bar button i {
            font-size: 20px;
            margin-bottom: 3px;
        }

        .app-bar button:hover {
            color: #d6d5da;
        }

        /* Styles for the canvas loader */
        #SD-loadscrn {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #fff;
            z-index: 9999;
        }

        #SD-loadtext {
            position: absolute;
            font-family: sans-serif;
            top: 50%;
            left: 50%;
            width: 250px;
            margin-left: -125px;
            margin-top: -125px;
            text-align: center;
            line-height: 150%;
            font-size: 16px;
        }
#viewporter {
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
    max-height: calc(100vh - 60px);
        }

canvas {
width: 100%;
    height: 100%;
display: block;
    max-height: calc(100vh - 60px);
}




                #referral-stats {
 display: flex;
    justify-content: space-between;
    background-color: #bf5d05;
    border: 1px solid #a24e03;
    padding: 13px;
    border-radius: 10px;
        }
        .stat {
            display: flex;
            align-items: center;
            flex: 1;
        }
        .stat-icon {
            margin-right: 10px;
            font-size: 20px; /* Adjust icon size */
            color: #ffffff; /* Icon color */
        }
        .stat-text {
            font-weight: bold;
        }
        #referral-link-section {
    background-color: rgba(46, 44, 55, 0.95);
    border: 1px solid #1e1d22;
    padding: 0px;
    text-align: left;
    margin-top: 10px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding-left: 0px;
        }
        .copy-button {
background-color: #111013;
    color: white;
    border: none;
    padding: 15px;
    cursor: pointer;
    border-radius: 10px;
    display: flex;
    align-items: center;
    font-size: 15px;
    border-top-right-radius: 0px !important;
    border-top-left-radius: 0px !important;
    border-bottom-left-radius: 0px !important;
        }
        .copy-button:hover {
            background-color: #111013;
        }
        .referral-link {
            flex-grow: 1;
            margin-right: 10px;
            font-weight: bold;
            color: #ffffff;
            white-space: nowrap; /* Prevent line break */
            overflow: hidden; /* Hide overflow */
            text-overflow: ellipsis; /* Add ellipsis */
        }
        .stat-icon {
            margin-right: 5px;
        }
        /* Popup styles */


   #user-rank {
    background-color: #fff;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    padding: 15px;
    display: flex;
    align-items: center;
    width: 100%;
    max-width: 100%; /* Ensures the max-width does not exceed the parent container */
    margin: 20px auto;
    box-sizing: border-box; /* Ensures padding is included in the width calculation */
    overflow: hidden; /* Prevents overflow of content */
}

        .user-info img {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin-right: 15px;
            border: 2px solid #ddd;
        }

        .user-details {
            display: flex;
            flex-direction: column;
            margin-right:15px;
        }

        .username {
            font-size: 18px;
            font-weight: bold;
            color: white;
        }

        .rank-info {
            font-size: 14px;
            color: #666;
            margin-top: 4px;
        }
        tr {
        
        display: flex;
    justify-content: space-between;
    padding: 10px;
    border-bottom: 1px solid rgb(74, 72, 85);
    padding-left: 10px !important;
    padding-right: 10px !important;    
        }

                td { 
                    font-weight: bold;
        }


    .popup {
        position: fixed;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
    }
    .popup-content {
        background-color: white;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        position: relative;
    }
    .close {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 20px;
        cursor: pointer;
    }

#checkin-popup {
    position: fixed;
    top: 20%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: red;
    color: white;
    padding: 10px 20px;
    border-radius: 5px;
    z-index: 1000;
}
.invite-section {
    cursor: pointer; /* Change cursor to pointer */
}


    </style>
</head>
<body>

    <!-- Content Container -->
    <div class="content">
        <!-- Home Page with only the canvas -->
       <div id="page1" class="page active" style="padding: 0; height: 100%; background: url(assets/img/splashscreen.png) no-repeat center center; background-size: cover;">
    <!-- Canvas screen code -->
    <script type="text/javascript">
        window.gameLangs = ['en'];
        window.gameJS = ['js/game.js'];
        window.gameOnLoadScript = "init();";
    </script>
    <script type="text/javascript" src="js/script.js"></script>
    <script type="text/javascript" src="js/hooks.js"></script>
    <script type="text/javascript" src="js/ads.js"></script>
    <div id="viewporter">
        <canvas id="canvas" width="700" height="900"></canvas>
    </div>
    <!-- Loader styles already in the <head> -->
</div>


<div id="page4" class="page" style=" color: #ffffff; padding: 20px; border-radius: 0px; width: auto; margin: 0 auto; box-shadow: 0 0 20px rgba(0, 0, 0, 0.2); height: calc(100vh - 70px); overflow-y: auto; padding-top: 7px !important;">
    <ul id="tasks-list" style="margin-bottom: 20px; margin-top: -5px; list-style-type: none; padding: 0;">
<div id="referral-stats" style="display: flex; justify-content: space-between; padding: 10px 15px; margin-top: 20px; border-radius: 10px; background: #1e1d22; color: white !important; border: 1px solid #101013; position: sticky; top: 0; z-index: 1000;">
    <div class="stat" style="display: flex; flex-direction: column; align-items: center; font-weight: bold;">
        <div style="display: flex; align-items: center; justify-content: center; width: 100%;">
            <img src="assets/img/littlediamond.png" style="height: 15px; padding-right: 7px;">
            <span style="font-weight: 500; text-align: center;">Available points:</span>
        </div>
        <span id="points-earned" style="margin-top: 5px; text-align: center; font-size: 35px; width: 100%;">0</span>
    </div>
</div>
       <p style=" font-weight: bold; ">Available Tasks:</p>
        <li id="daily-checkin" style="position: relative; margin-bottom: 7px; background-color: #2c2a34; border: 1px solid rgb(16, 16, 19); color: white; font-weight: 590; font-size: 14px; padding-left: 13px; border-radius: 10px; line-height: 20px; padding-top: 10px; padding-bottom: 10px; cursor: pointer;">
            <span style="display: block; font-size: 15px; font-weight: bold;">Daily check-in</span>
            <span><img src="assets/img/littlediamond.png" style="height: 15px;"> +100</span>
            <!-- Approved icon for successful check-in -->
            <img id="approved-icon-checkin" src="assets/img/approved.png" style="display: none;height: 20px;position: absolute;right: 15px;top: 20px;">
        </li>

        <!-- Other list items remain unchanged -->
<li id="subscribe-channel" style="position: relative; margin-bottom: 7px; background-color: #2c2a34; border: 1px solid #101013; color: white; font-weight: 590; font-size: 14px; padding-left: 13px; border-radius: 10px; line-height: 20px; padding-top: 10px; padding-bottom: 10px; cursor: pointer;" onclick="subscribeToChannel()">
    <span style="display: block; font-size: 15px; font-weight: bold;">Subscribe to Telegram Channel</span>
    <span style="font-weight: bold;">
        <img src="assets/img/littlediamond.png" style="height: 15px;"> +500 
    </span>
    <img id="approved-icon-channel" src="assets/img/approved.png" style="display: none; height: 20px;position: absolute;right: 15px;top: 20px;">
</li>

        <li id="share-link" style="position: relative; margin-bottom: 7px; background-color: #2c2a34; border: 1px solid #101013; color: white; font-weight: 590; font-size: 14px; padding-left: 13px; border-radius: 10px; line-height: 20px; padding-top: 10px; padding-bottom: 10px; cursor: pointer;" onclick="shareToTelegramlink()">
                    <span style="display: block; font-size: 15px; font-weight: bold;">Share Link to your Telegram</span>
                    <span style="">
                        <img src="assets/img/littlediamond.png" style="height: 15px;"> +500 
                    </span>
            <img id="approved-icon-share" src="assets/img/approved.png" style="display: none;height: 20px;position: absolute;right: 15px;top: 20px;">
                </li>

<li id="invite-3-friends-section" style="    padding-right: 13px;font-weight: 590; font-size: 14px; margin-bottom: 7px; background-color: #2c2a34; border: 1px solid #101013; color: white; padding-left: 13px; border-radius: 10px; line-height: 20px; padding-top: 10px; padding-bottom: 10px; display: flex; justify-content: space-between; align-items: center; opacity: 0.5; pointer-events: none;"
    onclick="Invite3Friends()">
    <div>
        <span style="display: block; font-size: 15px; font-weight: bold;">Invite 3 Friends</span>
        <span style="display: flex; align-items: center;">
            <img src="assets/img/littlediamond.png" style="height: 15px; margin-right: 5px;"> +3000 
        </span>
    </div>
    <span id="referral-status-3-friends" style="border: 1px solid #fff; border-radius: 10px; padding: 5px 10px; background-color: rgba(255, 255, 255, 0.2); margin-left: auto;"> 0/3 </span>
</li>



<li id="invite-10-friends-section" style="    padding-right: 13px;font-weight: 590; font-size: 14px; margin-bottom: 7px; background-color: #2c2a34; border: 1px solid #101013; color: white; padding-left: 13px; border-radius: 10px; line-height: 20px; padding-top: 10px; padding-bottom: 10px; display: flex; justify-content: space-between; align-items: center; opacity: 0.5; pointer-events: none;"
    onclick="Invite10Friends()">
    <div>
        <span style="display: block; font-size: 15px; font-weight: bold;">Invite 10 Friends</span>
        <span style="display: flex; align-items: center;">
            <img src="assets/img/littlediamond.png" style="height: 15px; margin-right: 5px;"> +10000 
        </span>
    </div>
    <span id="referral-status-10-friends" style="border: 1px solid #fff; border-radius: 10px; padding: 5px 10px; background-color: rgba(255, 255, 255, 0.2); margin-left: auto;"> 0/10 </span>
</li>



<li id="invite-50-friends-section"  style="    padding-right: 13px;font-weight: 590; font-size: 14px; margin-bottom: 7px; background-color: #2c2a34; border: 1px solid #101013; color: white; padding-left: 13px; border-radius: 10px; line-height: 20px; padding-top: 10px; padding-bottom: 10px; display: flex; justify-content: space-between; align-items: center; opacity: 0.5; pointer-events: none;"
    onclick="Invite50Friends()">
    <div>
        <span style="display: block; font-size: 15px; font-weight: bold;">Invite 50 Friends</span>
        <span style="display: flex; align-items: center;">
            <img src="assets/img/littlediamond.png" style="height: 15px; margin-right: 5px;"> +50000 
        </span>
    </div>
    <span id="referral-status-50-friends" style="border: 1px solid #fff; border-radius: 10px; padding: 5px 10px; background-color: rgba(255, 255, 255, 0.2); margin-left: auto;"> 0/50 </span>
</li>
        
        <!-- ... other list items ... -->

    </ul>

    
    <div id="copy-popup-checkin" class="popup" style="display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgb(30, 29, 34); color: white; padding: 20px; opacity: 0.9; border-radius: 10px; width: 70%; font-weight: 600; height: auto; text-align: center;">
        Hooray! 🎉 Daily check-in successful! You've earned 100 points!
    </div>
    
<div id="checkin-popup" style="display: none; z-index: 1000; text-align: center; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgb(30, 29, 34); color: white; padding: 20px; opacity: 0.88; border-radius: 10px; width: 70%; font-weight: 600;">
    You have already claimed your points in the last 24 hours.
</div>
    

<!-- Popup for success message -->
<div id="success-popup" class="popup" style="display: none; z-index: 1000; text-align: center; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgb(30, 29, 34); color: white; padding: 20px; opacity: 0.88; border-radius: 10px; width: 70%; font-weight: 600;height: auto;">
    You have successfully subscribed and received 500 points! 🎉
</div>

<!-- Popup for error message -->
<div id="error-popup" class="popup" style="display: none; z-index: 1000; text-align: center; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgb(30, 29, 34); color: white; padding: 20px; opacity: 0.88; border-radius: 10px; width: 70%; font-weight: 600;height: auto;">
    You have already completed this task!
</div>

    <!-- Popup for success message -->
<div id="success-popup-share" class="popup" style="display: none; z-index: 1000; text-align: center; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgb(30, 29, 34); color: white; padding: 20px; opacity: 0.88; border-radius: 10px; width: 70%; font-weight: 600;height: auto;">
    You have successfully shared and received 500 points! 🎉
</div>

<!-- Popup for error message -->
<div id="error-popup-share" class="popup" style="display: none; z-index: 1000; text-align: center; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgb(30, 29, 34); color: white; padding: 20px; opacity: 0.88; border-radius: 10px; width: 70%; font-weight: 600;height: auto;">
    You have already completed this task!
</div>

        <!-- Popup for success message -->
<div id="success-popup-3friends" class="popup" style="display: none; z-index: 1000; text-align: center; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgb(30, 29, 34); color: white; padding: 20px; opacity: 0.88; border-radius: 10px; width: 70%; font-weight: 600;height: auto;">
    You have successfully claimed 3000 points! 🎉
</div>

<!-- Popup for error message -->
<div id="error-popup-3friends" class="popup" style="display: none; z-index: 1000; text-align: center; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgb(30, 29, 34); color: white; padding: 20px; opacity: 0.88; border-radius: 10px; width: 70%; font-weight: 600;height: auto;">
    You have already completed this task!
</div>

            <!-- Popup for success message -->
<div id="success-popup-10friends" class="popup" style="display: none; z-index: 1000; text-align: center; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgb(30, 29, 34); color: white; padding: 20px; opacity: 0.88; border-radius: 10px; width: 70%; font-weight: 600;height: auto;">
    You have successfully claimed 10000 points! 🎉
</div>

<!-- Popup for error message -->
<div id="error-popup-10friends" class="popup" style="display: none; z-index: 1000; text-align: center; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgb(30, 29, 34); color: white; padding: 20px; opacity: 0.88; border-radius: 10px; width: 70%; font-weight: 600;height: auto;">
    You have already completed this task!
</div>

            <!-- Popup for success message -->
<div id="success-popup-50friends" class="popup" style="display: none; z-index: 1000; text-align: center; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgb(30, 29, 34); color: white; padding: 20px; opacity: 0.88; border-radius: 10px; width: 70%; font-weight: 600;height: auto;">
    You have successfully claimed 50000 points! 🎉
</div>

<!-- Popup for error message -->
<div id="error-popup-50friends" class="popup" style="display: none; z-index: 1000; text-align: center; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgb(30, 29, 34); color: white; padding: 20px; opacity: 0.88; border-radius: 10px; width: 70%; font-weight: 600;height: auto;">
    You have already completed this task!
</div>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
const userId = Telegram.WebApp.initDataUnsafe.user.id.toString();
const dailyCheckinElement = document.getElementById('daily-checkin');
let timerInterval;

// Key for localStorage to store the last check-in time
const lastCheckinKey = `lastCheckin_${userId}`;
const checkinInterval = 60 * 1000; // 1 minute in milliseconds (for testing)
const checkinCooldown = 24 * 60 * 60 * 1000; // 24 hours in milliseconds

document.addEventListener("DOMContentLoaded", function() {
    // Check the check-in status on load
    checkDailyCheckinStatus();

    // Add event listener for daily check-in
    dailyCheckinElement.addEventListener('click', dailyCheckin);
});

async function checkDailyCheckinStatus() {
    const lastCheckin = localStorage.getItem(lastCheckinKey);
    const currentTime = Date.now();

    // Check if 1 minute has passed since last check-in
    if (lastCheckin && (currentTime - lastCheckin < checkinInterval)) {
        disableDailyCheckin();
    } else {
        enableDailyCheckin();
    }
}

async function dailyCheckin() {
    const lastCheckin = localStorage.getItem(lastCheckinKey);
    const currentTime = Date.now();

    // Check if 24 hours have passed since the last check-in
    if (lastCheckin && (currentTime - lastCheckin < checkinCooldown)) {
        showCheckinPopup(); // Show the popup instead of returning an error
        return; // Exit the function early
    }

    try {
        const response = await fetch("https://telegram-bot-degen-town.replit.app/api/user/dailycheckin", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ userId })
        });

        const data = await response.json();
        console.log("API Response:", data); // Log the API response for debugging

        if (response.ok) {
            const popup = document.getElementById('copy-popup-checkin');
            popup.style.display = 'block';
            setTimeout(() => {
                popup.style.display = 'none';
            }, 2500);

            // Keep the approved icon visible to inform the user that the task is done
            
            disableDailyCheckin();
            localStorage.setItem(lastCheckinKey, Date.now());
            startTimer(60); // Start 1-minute timer (in seconds for testing)
        } else {
            showPopup(`Daily check-in failed: ${data.error}`);
        }
    } catch (error) {
        console.error("Failed to complete daily check-in:", error);
    }
}

function disableDailyCheckin() {
    dailyCheckinElement.style.cursor = 'not-allowed'; // Change cursor to indicate it's disabled
    dailyCheckinElement.removeEventListener('click', dailyCheckin); // Remove click event listener
    dailyCheckinElement.classList.add('blocked'); // Add a class to style the blocked state
    document.getElementById('approved-icon-checkin').style.display = 'block'; 
    document.getElementById('daily-checkin').style.opacity = '0.68';
}

function enableDailyCheckin() {
    dailyCheckinElement.style.cursor = 'pointer'; // Change cursor to indicate it's clickable
    dailyCheckinElement.addEventListener('click', dailyCheckin); // Re-add click event listener
    dailyCheckinElement.classList.remove('blocked'); // Remove the blocked class
    // Hide the approved icon only when the daily check-in is available again
    document.getElementById('approved-icon').style.display = 'none';
}

function startTimer(duration) {
    clearInterval(timerInterval); // Clear any existing timer
    let timer = duration, hours, minutes, seconds;

    timerInterval = setInterval(() => {
        hours = parseInt(timer / 3600, 10);
        minutes = parseInt((timer % 3600) / 60, 10);
        seconds = parseInt(timer % 60, 10);

        document.getElementById('timer').innerText = 
            `${(hours < 10 ? "0" : "")}${hours}:${(minutes < 10 ? "0" : "")}${minutes}:${(seconds < 10 ? "0" : "")}${seconds}`;

        if (--timer < 0) {
            clearInterval(timerInterval);
            document.getElementById('timer').innerText = "Ready for check-in!";
            enableDailyCheckin(); // Re-enable the button
        }
    }, 1000);
}

function showPopup(message) {
    document.getElementById('popup-message').innerText = message;
    document.getElementById('popup').style.display = 'block';
}

function closePopup() {
    document.getElementById('popup').style.display = 'none';
}

function showCheckinPopup() {
    const checkinPopup = document.getElementById('checkin-popup');
    checkinPopup.style.display = 'block';
document.getElementById('daily-checkin').style.opacity = '0.68';
    // Hide the popup after 2 seconds
    setTimeout(() => {
        checkinPopup.style.display = 'none';
    }, 2500);
}


   async function subscribeToChannel() {
    const userId = Telegram.WebApp.initDataUnsafe.user.id.toString();
    window.open('https://t.me/degentown_news', '_blank');

const response = await fetch("https://telegram-bot-degen-town.replit.app/api/user/subscribe-channel", {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json'
    },
    body: JSON.stringify({ userId })
});

    const data = await response.json();
    if (data.success) {
        document.getElementById('subscribe-channel').style.opacity = '0.68';
        document.getElementById('approved-icon-channel').style.display = 'block'; 
            const popup = document.getElementById('success-popup');
            popup.style.display = 'block';
            setTimeout(() => {
                popup.style.display = 'none';
            }, 3500);
    } else {
document.getElementById('subscribe-channel').style.opacity = '0.68';
                    const popup = document.getElementById('error-popup');
            popup.style.display = 'block';
            setTimeout(() => {
                popup.style.display = 'none';
            }, 3500);
    }
}

function showPopup(popupId) {
    document.getElementById(popupId).style.display = 'flex'; // Display the popup
}

function closePopup(popupId) {
    document.getElementById(popupId).style.display = 'none'; // Hide the popup
}

async function shareToTelegramlink() {
    const userId = Telegram.WebApp.initDataUnsafe.user.id.toString();
    const message = `https://t.me/degentown_bot?start=${userId}    Join Degen Town Journey! Stay tuned for exciting airdrops and special rewards from Degen Town!`;
    
    // Create a share link
    const shareUrl = `https://telegram.me/share/url?url=${encodeURIComponent(message)}`;
    
    // Open the share link in a new window
    window.open(shareUrl, '_blank');

    // Update the backend to add points for sharing
    const response = await fetch("https://telegram-bot-degen-town.replit.app/api/user/share-points", {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ userId }),
    });

    if (response.ok) {
        const data = await response.json();
        document.getElementById('approved-icon-share').style.display = 'block'; 
            const popup = document.getElementById('success-popup-share');
            popup.style.display = 'block';
            setTimeout(() => {
                popup.style.display = 'none';
            }, 3500);
        document.getElementById("share-link").style.pointerEvents = "none";
        document.getElementById('share-link').style.opacity = '0.68';// Make it unclickable
    } else {
        const data = await response.json(); 
        document.getElementById('share-link').style.opacity = '0.68';
                    const popup = document.getElementById('error-popup-share');
            popup.style.display = 'block';
            setTimeout(() => {
                popup.style.display = 'none';
            }, 3500);
    }
}

function showPopup(message) {
    // Create and display your popup here
    alert(message); // Replace this with your actual popup implementation
}


async function Invite3Friends() {
    const userId = Telegram.WebApp.initDataUnsafe.user.id.toString();
    const response = await fetch('https://telegram-bot-degen-town.replit.app/api/user/invite-three-friends', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ userId }),
    });

    const data = await response.json();
    const inviteSection = document.getElementById('invite-3-friends-section');

    if (data.success) {
        inviteSection.style.opacity = '0.68';
        const popup = document.getElementById('success-popup-3friends');
        popup.style.display = 'block';
        setTimeout(() => {
            popup.style.display = 'none';
        }, 3500);
    } else {
        inviteSection.style.opacity = '0.68';
        const popup = document.getElementById('error-popup-3friends');
        popup.style.display = 'block';
        setTimeout(() => {
            popup.style.display = 'none';
        }, 3500);
    }
}

async function updateInvite3FriendsSection(userId) {
    try {
        const response = await fetch(`https://telegram-bot-degen-town.replit.app/api/user/referrals/${userId}?t=${new Date().getTime()}`);
        const data = await response.json();
        console.log("Fetched Data:", data); // Debugging log

        const referralsCount = data.totalReferrals || 0;
        document.getElementById("referral-status-3-friends").textContent = `${referralsCount}/3`;

        const inviteSection = document.getElementById("invite-3-friends-section");
        if (referralsCount >= 3 && !data.invite3FriendsClaimed) {
            inviteSection.style.opacity = "1"; // Fully opaque
            inviteSection.style.pointerEvents = "auto"; // Enable clicks
        } else {
            inviteSection.style.opacity = "0.75"; // Semi-transparent or greyed out
            inviteSection.style.pointerEvents = "none"; // Disable clicks
        }
    } catch (error) {
        console.error("Error fetching referral data:", error);
    }
}

async function Invite10Friends() {
    const userId = Telegram.WebApp.initDataUnsafe.user.id.toString();
    const response = await fetch('https://telegram-bot-degen-town.replit.app/api/user/invite-ten-friends', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ userId }),
    });

    const data = await response.json();
    const inviteSection = document.getElementById('invite-10-friends-section');

    if (data.success) {
        inviteSection.style.opacity = '0.68';
        const popup = document.getElementById('success-popup-10friends');
        popup.style.display = 'block';
        setTimeout(() => {
            popup.style.display = 'none';
        }, 3500);
    } else {
        inviteSection.style.opacity = '0.68';
        const popup = document.getElementById('error-popup-10friends');
        popup.style.display = 'block';
        setTimeout(() => {
            popup.style.display = 'none';
        }, 3500);
    }
}

async function updateInvite10FriendsSection(userId) {
    try {
        const response = await fetch(`https://telegram-bot-degen-town.replit.app/api/user/referrals/${userId}?t=${new Date().getTime()}`);
        const data = await response.json();
        console.log("Fetched Data:", data); // Debugging log

        const referralsCount = data.totalReferrals || 0;
        document.getElementById("referral-status-10-friends").textContent = `${referralsCount}/10`;

        const inviteSection = document.getElementById("invite-10-friends-section");
        if (referralsCount >= 10 && !data.invite10FriendsClaimed) {
            inviteSection.style.opacity = "1"; // Fully opaque
            inviteSection.style.pointerEvents = "auto"; // Enable clicks
        } else {
            inviteSection.style.opacity = "0.75"; // Semi-transparent or greyed out
            inviteSection.style.pointerEvents = "none"; // Disable clicks
        }
    } catch (error) {
        console.error("Error fetching referral data:", error);
    }
}

async function Invite50Friends() {
    const userId = Telegram.WebApp.initDataUnsafe.user.id.toString();
    const response = await fetch('https://telegram-bot-degen-town.replit.app/api/user/invite-fifty-friends', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ userId }),
    });

    const data = await response.json();
    const inviteSection = document.getElementById('invite-50-friends-section');

    if (data.success) {
        inviteSection.style.opacity = '0.68';
        const popup = document.getElementById('success-popup-50friends');
        popup.style.display = 'block';
        setTimeout(() => {
            popup.style.display = 'none';
        }, 3500);
    } else {
        inviteSection.style.opacity = '0.68';
        const popup = document.getElementById('error-popup-50friends');
        popup.style.display = 'block';
        setTimeout(() => {
            popup.style.display = 'none';
        }, 3500);
    }
}

async function updateInvite50FriendsSection(userId) {
    try {
        const response = await fetch(`https://telegram-bot-degen-town.replit.app/api/user/referrals/${userId}?t=${new Date().getTime()}`);
        const data = await response.json();
        console.log("Fetched Data:", data); // Debugging log

        const referralsCount = data.totalReferrals || 0;
        document.getElementById("referral-status-50-friends").textContent = `${referralsCount}/50`;

        const inviteSection = document.getElementById("invite-50-friends-section");
        if (referralsCount >= 50 && !data.invite50FriendsClaimed) {
            inviteSection.style.opacity = "1"; // Fully opaque
            inviteSection.style.pointerEvents = "auto"; // Enable clicks
        } else {
            inviteSection.style.opacity = "0.75"; // Semi-transparent or greyed out
            inviteSection.style.pointerEvents = "none"; // Disable clicks
        }
    } catch (error) {
        console.error("Error fetching referral data:", error);
    }
}

window.addEventListener("load", () => {
    const userId = Telegram.WebApp.initDataUnsafe.user.id.toString();
    updateInvite3FriendsSection(userId);
    updateInvite10FriendsSection(userId);
    updateInvite50FriendsSection(userId);

    document.getElementById('invite-3-friends-section').addEventListener('click', Invite3Friends);
    document.getElementById('invite-10-friends-section').addEventListener('click', Invite10Friends);
    document.getElementById('invite-50-friends-section').addEventListener('click', Invite50Friends);
});

</script>


    <style>
        /* Add CSS for the blocked state */
        #daily-checkin.blocked {
            opacity: 0.68; /* Make it look disabled */
            pointer-events: none; /* Prevent clicking */
        }
    </style>
</div>

        
<div id="page3" class="page"  color: #ffffff; padding: 20px; border-radius: 0px; width: auto; margin: 0 auto; box-shadow: 0 0 20px rgba(0, 0, 0, 0.2); height: calc(100vh - 100px); overflow-y: auto;">

    <div id="referral-stats" style="display: flex; justify-content: space-between; padding: 10px 15px; margin-top: 20px;     margin-bottom: 12px; border-radius: 10px; background: #1e1d22; color: white !important; border: 1px solid #101013; position: sticky; top: 0; z-index: 1000;">
    <div class="stat" style="display: flex; flex-direction: column; align-items: center; font-weight: bold;">
        <div style="display: flex; align-items: center; justify-content: center; width: 100%;">
            <img src="assets/img/littlediamond.png" style="height: 15px; padding-right: 7px;">
            <span style="font-weight: 500; text-align: center;">Available points:</span>
        </div>
        <span id="points-balance" style="margin-top: 5px; text-align: center; font-size: 35px; width: 100%;">0</span>
    </div>
</div>
    <div id="referral-stats" style="display: flex; justify-content: space-between; padding: 10px 15px; margin-top: 0; margin-bottom: 0px; border-radius: 10px; background: #1e1d22; color: white !important; border: 1px solid #101013;">
        <div class="stat" style="justify-content: space-evenly;flex: 1; text-align: left; font-weight: bold; border-right: 1px solid #4a4855; padding-right: 10px;">
            <img src="assets/img/friends.png" style="height: 15px; padding-right: 0px;">
            Referrals: <span id="referrals-count">0</span>
        </div>
        <div class="stat" style="justify-content: space-evenly;padding-left: 15px;flex: 1; text-align: center; font-weight: bold;">
            <img src="assets/img/littlediamond.png" style="height: 15px; padding-right: 0px;">
            Earned: <span id="invite-points-earned">0</span>
        </div>
    </div>

    <h3 style="text-align: center; color: #402104; margin: 20px 0;"></h3>

    <div id="example-users" style="margin-bottom: 20px;background-color: rgba(46, 44, 55, 0.95); padding: 0px; border-radius: 10px;">
        <div class="invite-header" style="border: none !important;background: #1e1d22;padding: 10px 15px;display: flex;justify-content: space-between;border-top-left-radius: 10px;border-top-right-radius: 10px;">
            <span style="flex: 2; text-align: left; font-weight: bold;">Name</span>
            <span style="flex: 1; text-align: center; font-weight: bold;">Level</span>
            <span style="flex: 1; text-align: right; font-weight: bold;">Earned</span>
        </div>
        <ul id="referral-list" style="scrollbar-width: none;list-style: none;padding: 0;margin: 0;max-height: 14vh;overflow-y: auto;padding-left: 5px;padding-right: 5px;">
            <!-- List to display referrals or "No Referrals Available" message -->
        </ul>
    </div>

    <h3 style="text-align: center;margin-top: 10px;color: #ffffff;font-size: 17px;font-weight: 600;background: #1e1d22;padding-top: 10px;border-top-left-radius: 10px;border-top-right-radius: 10px;border-top: 1px solid #101013;border-left: 1px solid #101013;border-right: 1px solid #101013;padding-bottom: 14px;margin-bottom: 0px;">Your Invite Link:</h3>
    <div id="referral-link-section" style="border-radius: 10px;text-align: center;margin-top: 0px;border-top-right-radius: 0px !important;border-top-left-radius: 0px !important;">
        <div class="referral-link" id="referral-link" style="padding-left: 0px !important;padding: 10px;border-radius: 10px;margin: 0 auto;display: inline-block;max-width: 80%;border-top-left-radius: 0px !important;padding-left: 15px !important;">
            Loading your referral link...
        </div>
        <button class="copy-button" onclick="copyLinkreferral()">
            <i class="fas fa-copy"></i>
        </button>
    </div>
    <div id="copy-popup-referral" class="popupreferral" style="text-align: center;display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgb(30, 29, 34); color: white; padding: 20px; opacity: 0.88; border-radius: 10px; width: 70%; font-weight: 600;">
        Invite Link copied to Clipboard! 
    </div>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
document.addEventListener("DOMContentLoaded", async function() {
  const userId = Telegram.WebApp.initDataUnsafe.user.id;

  async function fetchReferralData(userId) {
    try {
      const response = await fetch(`https://telegram-bot-degen-town.replit.app/api/user/referrals/${userId}`);
      if (!response.ok) throw new Error("Error fetching data");

      const userData = await response.json();
      console.log("User data:", userData); // Log user data for debugging

      document.getElementById("points-balance").textContent = userData.totalPoints || 0;

            const referralList = document.getElementById("referral-list");

            if (userData.referrals.length === 0) {} else {
                // Display referral details in table
                userData.referrals.forEach(referral => {});
            }

        } catch (error) {
            console.error("Failed to fetch referral data:", error);
        }
    }

    await fetchReferralData(userId);

});


// Function to get the referral level
function getReferralLevel(totalReferrals) {
    if (totalReferrals >= 50) return 6;
    if (totalReferrals >= 20) return 5;
    if (totalReferrals >= 15) return 4;
    if (totalReferrals >= 10) return 3;
    if (totalReferrals >= 3) return 2;
    return 1; // Level 1 for 0 to 2 referrals
}

// Copy function for the referral link
function copyLinkreferral() {
    const referralLinkElement = document.getElementById('referral-link');
    const referralLink = referralLinkElement.textContent;

    const additionalText = "Join Degen Town Journey! Stay tuned for exciting airdrops and special rewards from Degen Town! ";

    if (referralLink && referralLink !== "Loading your referral link...") {
        const fullTextToCopy = `${additionalText}${referralLink}`;

        const textArea = document.createElement("textarea");
        textArea.value = fullTextToCopy;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand("copy");
        document.body.removeChild(textArea);

        const popup = document.getElementById('copy-popup-referral');
        popup.style.display = 'block';
        setTimeout(() => {
            popup.style.display = 'none';
        }, 2000);
    } else {
        console.error("Referral link is empty or not ready.");
    }
}
</script>

</div>



       
    <div id="page2" class="page"  color: #ffffff; padding: 20px; border-radius: 0px; width: auto; margin: 0 auto; box-shadow: 0 0 20px rgba(0, 0, 0, 0.2); height: calc(100vh - 70px); overflow-y: auto;  padding-top: 7px !important;">

    <!-- Current User Rank -->
    <div id="user-rank" class="user-info" style="width: auto !important; background: #1e1d22; color: white !important; border: 1px solid #101013;">
        <!-- User Profile Picture and Username will be inserted here -->
    </div>

    <!-- Leaderboard Container -->
    <div id="leaderboard-container" style="border-radius: 10px;background-color: rgba(46, 44, 55, 0.95); padding: 0; max-height: 60vh; overflow: hidden;">
        <div class="leaderboard-header" style="border-top-left-radius: 10px;
    border-top-right-radius: 10px;padding-top: 10px !important;padding-bottom: 30px !important;background: #1e1d22; padding: 15px; position: sticky; top: 0; z-index: 10;">
            <span style="float: left;font-weight: bold;">Players Name</span>
            <span style="float: right;font-weight: bold;">Points Earned</span>
        </div>
        <ul id="leaderboard-list" style="padding-left: 10px !important; padding-right: 10px !important;scrollbar-width: none;list-style: none; padding: 0; margin: 0; max-height: 50vh; overflow-y: auto;">
            <!-- Leaderboard items will be added here -->
        </ul>
</div>
                <p style=" margin-top: 5px; font-size: 14px; font-weight: 500; opacity: 0.85; margin-left: 5px; ">Updated every 5 mins </p>

   <script>
document.addEventListener('DOMContentLoaded', generateLeaderboard);

async function generateLeaderboard() {
    const leaderboardList = document.getElementById('leaderboard-list');
    const colors = ['#F28B82', '#FBBC05', '#34A853', '#4285F4', '#A142F4', '#FF6D01', '#46BD8B', '#FFBF00', '#FF4500', '#9932CC'];

    // Fetch leaderboard data from the backend
    try {
        const response = await fetch("https://telegram-bot-degen-town.replit.app/api/leaderboard");
        const leaderboardData = await response.json();

        // Check if the Telegram WebApp is ready and get the user data
        Telegram.WebApp.ready();
        const user = Telegram.WebApp.initDataUnsafe.user;
        let telegramUserRank, telegramUserPoints;

        // Insert Telegram user details if present
        if (user) {
            // Find the user's rank in the leaderboard data
            const userIndex = leaderboardData.findIndex(u => u.username === user.username);
            telegramUserRank = userIndex >= 0 ? userIndex + 1 : leaderboardData.length + 1;
            telegramUserPoints = userIndex >= 0 ? leaderboardData[userIndex].totalPoints : 0;

            // Add the Telegram user info at the top
            const userRankElement = document.getElementById('user-rank');
            if (userRankElement) {
                userRankElement.innerHTML = `
                    <div style="display: flex; align-items: center; justify-content: space-between; width: 100%; color: white;">
                        <div style="display: flex; align-items: center;">
                            <div style="width: 60px; height: 60px; border-radius: 50%; background-color: ${colors[telegramUserRank % colors.length]}; color: #ffffff; text-align: center; line-height: 60px; font-size: 24px;">
                                ${user.username ? user.username.charAt(0).toUpperCase() : 'U'}
                            </div>
                            <div style="margin-left: 10px;">
                                <span style="font-weight: bold;">${user.username || "User"}</span>
                                <span style="display: block; color: white;">Rank: #${telegramUserRank}</span>
                            </div>
                        </div>
                        <span style="color: white; margin-left: auto;">
                            ${telegramUserPoints} <img src="assets/img/littlediamond.png" style="width: 19px; height:19px; margin-bottom:-4px;border: none !important;">
                        </span>
                    </div>
                `;
            }
        }

        // Display leaderboard users
        leaderboardData.forEach((user, index) => {
            const username = user.username;
            const points = user.totalPoints;
            const color = colors[index % colors.length];
            addLeaderboardEntry(username, points, index + 1, color);
        });
    } catch (error) {
        console.error("Failed to fetch leaderboard data:", error);
    }

    function addLeaderboardEntry(username, points, rank, color) {
        const listItem = document.createElement('li');
        listItem.style.display = 'flex';
        listItem.style.alignItems = 'center';
        listItem.style.padding = '10px';
        listItem.style.borderBottom = '1px solid #4a4855';

        const profilePicture = document.createElement('div');
        profilePicture.style.width = '30px';
        profilePicture.style.height = '30px';
        profilePicture.style.borderRadius = '50%';
        profilePicture.style.backgroundColor = color;
        profilePicture.style.color = '#ffffff';
        profilePicture.style.display = 'flex';
        profilePicture.style.justifyContent = 'center';
        profilePicture.style.alignItems = 'center';
        profilePicture.innerText = username.charAt(0).toUpperCase();
        profilePicture.style.marginRight = '10px';

        const usernameContainer = document.createElement('div');
        usernameContainer.style.display = 'flex';
        usernameContainer.style.flexDirection = 'column';

        const usernameSpan = document.createElement('span');
        usernameSpan.innerText = username;
        usernameSpan.style.fontSize = '15px';
        usernameSpan.style.fontWeight = 'bold';

        const rankSpan = document.createElement('span');
        rankSpan.innerText = `Rank: #${rank}`;
        rankSpan.style.fontSize = '13px';
        rankSpan.style.color = 'white';
        rankSpan.style.marginTop = '4px';

        usernameContainer.appendChild(usernameSpan);
        usernameContainer.appendChild(rankSpan);

        const pointsSpan = document.createElement('span');
        pointsSpan.innerHTML = `${points} <img src="assets/img/littlediamond.png" style="height: 15px;">`;
        pointsSpan.style.color = 'white';
        pointsSpan.style.marginLeft = 'auto';

        listItem.appendChild(profilePicture);
        listItem.appendChild(usernameContainer);
        listItem.appendChild(pointsSpan);

        leaderboardList.appendChild(listItem);
    }
}

</script>



</div>


<div id="page5" class="page" style="color: #ffffff;padding: 20px;border-radius: 0px;width: auto;margin: 0 auto;box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);height: 100%;overflow-y: auto;padding-top: 5px !important;">
    <h2 style="text-align: center;color: white;font-size: 28px;margin-top: 10px;font-family: system-ui;margin-bottom: 0px;">SEEDSALE</h2>
    <p style="text-align: center; color: white; margin-top: 0px;">Stage 1</p>
    <p id="progress-text2" style="color: white; font-size: 20px; font-weight: bold; text-align: left; margin-top: 25px; font-family: system-ui;">DEGEN TOWN ALREADY RAISED:</p>
    <p id="progress-text" style="text-align: left; color: white; font-size: 20px; margin-top: -17px !important; margin-bottom: 10px;">$0 / $100,000</p>
    <div id="progress-container" style="margin-bottom: 20px; background-color: #e0e0e0; border-radius: 50px; height: 30px; width: 100%;">
        <div id="progress-bar" style="background: linear-gradient(to bottom, #fd8e0b, #ffc30f); border-radius: 50px; height: 30px; width: 0%;"></div>
    </div>
    <div style="text-align: center;">
        <div id="qrcode" style="margin-top: 25px !important;margin: 20px auto; width: 170px; height: 170px; background-color: #ffffff; padding: 10px; border-radius: 10px;"></div>
        <p style="text-align: center;margin-top: 10px;color: #ffffff;font-size: 17px;font-weight: 600;background: #1e1d22;padding-top: 10px;border-top-left-radius: 10px;border-top-right-radius: 10px;border-top: 1px solid #101013;border-left: 1px solid #101013;border-right: 1px solid #101013;padding-bottom: 14px;">Send funds only to this wallet</p>
        
        <div style="display: flex;justify-content: center;align-items: center;gap: 0px;margin-top: -20px;background: rgba(46, 44, 55, 0.65);border-bottom-right-radius: 10px;border-bottom-left-radius: 10px;border-bottom: 1px solid #101013;border-left: 1px solid #101013;border-right: 1px solid #101013;">
            <p id="wallet-address" style="font-size: 16px;background-color: #ffffff;color: #1e2739;padding: 10px 15px;width: 230px;text-align: left;white-space: nowrap;overflow: hidden;display: inline-block;border-top-left-radius: 10px;border-bottom-left-radius: 10px;">
                <!-- Address will be dynamically updated -->
            </p>

            <button onclick="copyAddress()" style="background-color: #1e1d22;border: none;cursor: pointer;padding: 0;padding: 6px;border-top-right-radius: 10px;border-bottom-right-radius: 10px;">
                <img src="https://img.icons8.com/ios-glyphs/30/ffffff/copy.png" alt="Copy Icon" style="width: 24px; height: 24px;">
            </button>
        </div>
    </div>

    <div style="margin: 20px 0; text-align: center;">
        <p style="color: white;font-size: 16px;margin-top: -10px;font-weight: bold;background: rgba(46, 44, 55, 0.7);padding: 10px;border-radius: 10px;">
            <i class="fa fa-exclamation-triangle" aria-hidden="true" style="margin-right: 8px; vertical-align: middle;"></i>
            Minimum purchase is 10 TON. Any smaller transactions will be refunded.
        </p>
    </div>

    <div id="copy-popupss" style="display: none;font-size: 17px;z-index: 999;position: absolute;top: 50%;left: 50%;transform: translate(-50%, -50%);background: rgb(30, 29, 34);color: white;padding: 20px;opacity: 0.88;border-radius: 10px;width: 60%;font-weight: 600;text-align: center;">
        Wallet Address copied to clipboard!
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
    // Declare fullWalletAddress at a higher scope for visibility
let fullWalletAddress = "";

// Function to display the wallet address
async function displayWallet() {
    console.log("displayWallet function called."); // Log to confirm function execution

    try {
const userId = Telegram.WebApp.initDataUnsafe.user.id.toString(); // Replace this with the actual userId you want to send
const response = await fetch("https://telegram-bot-degen-town.replit.app/api/getWalletAddress", {
    method: "POST",
    headers: {
        "Content-Type": "application/json"
    },
    body: JSON.stringify({ userId }) // Send userId in the body
});

        // Log the response status
        console.log("API response status:", response.status);

        // Check if the response is okay
        if (!response.ok) {
            console.error("Network response was not ok:", response.statusText);
            document.getElementById("wallet-address").textContent = "Error fetching address.";
            return;
        }

        const data = await response.json();
        console.log("Data received from API:", data); // Log the received data

        // Check if walletAddress exists in the data
        if (data.walletAddress) {
        fullWalletAddress = data.walletAddress;
        document.getElementById("wallet-address").textContent = truncateAddress(fullWalletAddress);
        new QRCode(document.getElementById("qrcode"), { text: fullWalletAddress, width: 170, height: 170 });
        } else {
            console.error("No wallet address found in API response.");
            document.getElementById("wallet-address").textContent = "No address found.";
        }
    } catch (error) {
        console.error("Error fetching wallet address:", error);
        document.getElementById("wallet-address").textContent = "Error fetching address.";
    }
}


// Function to truncate wallet address
function truncateAddress(address) {
    if (address.length > 10) {
        return address.slice(0, 10) + "..." + address.slice(-10);
    }
    return address; // Return the original address if it's not long
}


const addresses = [
        "UQAQVKfyMsndMNjCBtA5rtWNkxTtUlWgH1zmZDYQgrU8LOe2",
        "UQBOr3Gv3BHiLb+3X49sYhpBmcyfWsPAoawGC2LAs7oJi+pa",
        "UQDEY0HVd8RA8yFN0jZZJL/09qerZc1WosoiZCwas/084Efp",
        "UQBCVIp+C075yevgObZBj5J9iIu0PnnT6IaE06sjERVND+lz",
        "EQA7C-qyxME_WTuzA_8WgeBm7pStGyI0toHMpmaK23k69fuj",
        "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"
      ];

const apiEndpoint = "https://toncenter.com/api/v2/getAddressInformation"; // TONCenter API endpoint
const apiKey = "a6bc56466ebb8b52e20b5714e3c08634600bc33300e77a4f98e77a59a7336eaf"; // You can add your API key if needed

// Function to fetch balance for an address
async function fetchBalance(address) {
    try {
        const response = await fetch(`${apiEndpoint}?address=${address}&api_key=${apiKey}`);
        const data = await response.json();
        return parseFloat(data.result.balance) / 1000000000; // Convert from nanotons to tons
    } catch (error) {
        console.error(`Error fetching balance for ${address}:`, error);
        return 0;
    }
}

// Function to calculate total balance for all addresses
async function calculateTotalBalance() {
    let totalBalance = 0;

    for (const address of addresses) {
        const balance = await fetchBalance(address);
        totalBalance += balance;
    }

    return totalBalance;
}

// Utility function for fetching TON to USD rate
async function fetchTonToUsdRate() {
    try {
        const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=the-open-network&vs_currencies=usd');
        const data = await response.json();
        if (data && data['the-open-network'] && data['the-open-network'].usd) {
            return data['the-open-network'].usd; // TON to USD exchange rate
        } else {
            console.error("Failed to fetch TON to USD rate");
            return 0;
        }
    } catch (error) {
        console.error("Error fetching TON to USD rate:", error);
        return 0;
    }
}

// Counting animation function
function animateValue(element, start, end, duration) {
    let startTime = null;

    function step(timestamp) {
        if (!startTime) startTime = timestamp;
        const progress = Math.min((timestamp - startTime) / duration, 1); // Normalize progress
        const currentValue = start + progress * (end - start);
        element.textContent = `$${currentValue.toFixed(2)} / $100,000`; // Update the text
        if (progress < 1) {
            window.requestAnimationFrame(step);
        }
    }

    window.requestAnimationFrame(step);
}

// Progress bar update function
function updateProgressBar(balanceInUsd) {
    const goal = 100000; // $100,000 goal
    const progressBar = document.getElementById("progress-bar");
    const progressText = document.getElementById("progress-text");

    const duration = 2000; // Animation duration in milliseconds

    // Animate counting up from $0 to balanceInUsd
    animateValue(progressText, 0, balanceInUsd, duration, progressBar);

    // Animate progress bar width
    const percentage = (balanceInUsd / goal) * 100;
    progressBar.style.transition = `width ${duration}ms ease-in-out`;
    progressBar.style.width = Math.min(percentage, 100) + "%"; // Ensure it doesn't exceed 100%
}

// Main function to fetch data and update the page
async function updatePage() {
    const totalBalanceInTon = await calculateTotalBalance(); // Fetch total balance for all addresses
    const tonToUsdRate = await fetchTonToUsdRate();

    const totalBalanceInUsd = totalBalanceInTon * tonToUsdRate; // Convert balance to USD
    updateProgressBar(totalBalanceInUsd);
}

// Trigger the main function when the page loads
document.addEventListener("DOMContentLoaded", () => {
    updatePage();
});



function copyAddress() {
    const walletAddress = fullWalletAddress; // Get the full wallet address

    // Try the Clipboard API
    if (navigator.clipboard) {
        navigator.clipboard.writeText(walletAddress)
            .then(() => {
                showCopyPopup(); // Display confirmation popup
            })
            .catch(err => {
                console.error("Failed to copy using Clipboard API: ", err);
                fallbackCopyText(walletAddress); // Use fallback if Clipboard API fails
            });
    } else {
        fallbackCopyText(walletAddress); // Use fallback for unsupported browsers
    }
}

function fallbackCopyText(text) {
    // Create a temporary textarea to hold the text
    const textarea = document.createElement('textarea');
    textarea.value = text;
    document.body.appendChild(textarea);
    textarea.select(); // Select the text in the textarea
    try {
        document.execCommand('copy'); // Execute the 'copy' command
        showCopyPopup(); // Display confirmation popup
    } catch (err) {
        console.error('Fallback copy failed: ', err);
    }
    document.body.removeChild(textarea); // Remove the textarea after copying
}

function showCopyPopup() {
    const popup = document.getElementById("copy-popupss");
    popup.style.display = "block";
    setTimeout(() => {
        popup.style.display = "none";
    }, 2000); // Hide popup after 2 seconds
}

// Call the displayWallet function when the page loads
window.onload = function() {
    displayWallet(); // Fetch and display the wallet address
};


    // Function to copy the address
    const page5 = document.getElementById('page5');

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                console.log('Page5 is visible. Fetching data...');
                updatePage();
                observer.unobserve(page5); 
            }
        });
    }, { threshold: 0.5 });

    // Start observing page5
    observer.observe(page5);


</script>

    </div>


       

    <!-- Fixed App Bar -->
<div class="app-bar" >
     <button onclick="showPage('page1')">
            <i class="fas fa-gamepad"></i>
            Game
        </button>
        <button onclick="showPage('page2')">
            <i class="fas fa-trophy"></i>
            Rank
        </button>
        <button onclick="showPage('page3')">
            <i class="fas fa-users"></i>
            Invite
        </button>
        <button onclick="showPage('page4')">
            <i class="fas fa-tasks"></i>
            Tasks
        </button>
        <button onclick="showPage('page5')">
            <i class="fas fa-wallet"></i>
            Seed
        </button>
    </div>

    <script>
        function showPage(pageId) {
            // Hide all pages
            var pages = document.querySelectorAll('.page');
            pages.forEach(function(page) {
                page.classList.remove('active');
            });

            // Show the selected page
            document.getElementById(pageId).classList.add('active');
        }
    </script>



<script>



        function showPopup() {
            const popup = document.getElementById('copy-popup');
            popup.style.display = 'block'; // Show popup
            setTimeout(() => {
                popup.style.display = 'none'; // Hide after 3 seconds
            }, 3000);
        }



    // Update the user's rank and name
    const currentUserRank = Math.floor(Math.random() * 100) + 1; // Example rank
    const currentUserName = "UserExample"; // Example Telegram name

    document.querySelector('#user-rank span').innerText = `${user.username}`;
    document.querySelector('#user-rank span[style*="font-style"]').innerText = `${currentUserName}`;
</script>
<script type="text/javascript">
Telegram.WebApp.ready();

// Get the Telegram user data
const user = Telegram.WebApp.initDataUnsafe.user;

// Initialize the referral link
let referralLink = '';

if (user && user.id) {
    // Generate referral link using user ID
    referralLink = `https://t.me/degentown_bot?start=${user.id}`;
    document.getElementById('referral-link').textContent = referralLink;
} else {
    document.getElementById('referral-link').textContent = 'User data unavailable';
}

// Function to share to Telegram Story
function shareToTelegramStory() {
                    setTimeout(function() {
                    document.getElementById('share-approved').src = 'assets/img/approved.png';
                }, 2000);
    const storyText = "Join the Game Name Journey! Stay tuned for exciting airdrops and special rewards from Game Name!";
    const storyLink = referralLink || "https://example.com"; // Fallback in case referralLink is empty

    // Construct the story sharing link
    const storyUrl = `https://t.me/share/url?url=${encodeURIComponent(storyLink)}&text=${encodeURIComponent(storyText)}`;

    // Open the link in Telegram's story sharing
    Telegram.WebApp.openTelegramLink(storyUrl);
}</script>
</body>
</html>
