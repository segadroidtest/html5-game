<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        function handlePayment(selectedOption) {
            // API call to your server to generate the invoice link
            fetch('https://8cca6e28-57f1-480d-b1c3-bfd484df182d-00-1f9iqamc2bpqc.spock.replit.dev/generate-invoice', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    points: selectedOption.value // Send selected option value (points)
                }),
            })
            .then(response => response.json())
            .then(data => {
                // Use WebApp SDK to open the invoice link
                window.Telegram.WebApp.openInvoice(data.invoiceLink, (status) => {
                    if (status === "paid") {
                        // Handle successful payment here
                        alert("Payment successful!");

                        // Call another function to update user points
                        updateUserPoints(selectedOption.value);
                    }
                });
            })
            .catch(error => {
                console.error("Error generating invoice:", error);
                alert("An error occurred while generating the invoice.");
            });
        }

        function updateUserPoints(points) {
            // Update user points in the database after successful payment
            fetch('https://your-backend-url.com/update-points', { // Change to your actual endpoint
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ points: points }),
            })
            .then(response => response.json())
            .then(data => {
                // Handle response from the backend
                console.log(data.message);
            })
            .catch(error => {
                console.error("Error updating user points:", error);
            });
        }
    </script>
</head>
<body>
    <h1>Welcome to the Payment Mini App</h1>
    <select id="diamond-options" style="color: #1e1d22 !important; font-weight: 595;
            padding: 10px;
            border-radius: 5px; 
            font-size: 17px; 
            background-color: #f8f9fa; 
            transition: border-color 0.3s; 
            margin-bottom: 10px;" 
            onfocus="this.style.borderColor='#0056b3'" 
            onblur="this.style.borderColor='#007bff'">
        <option value="50">700 Points = 50 Stars ⭐</option>
        <option value="100">1500 Points = 100 Stars ⭐</option>
        <option value="250">5000 Points = 250 Stars ⭐</option>
        <option value="500">10k Points = 500 Stars ⭐</option>
        <option value="2000">100k Points = 2000 Stars ⭐</option>
    </select>
    <button onclick="handlePayment(document.getElementById('diamond-options'))" style="
        padding: 10px 20px;
        border: none;
        border-radius: 5px; 
        background-color: #1f9611; 
        color: white; 
        font-size: 16px; 
        cursor: pointer; 
        transition: background-color 0.3s, transform 0.2s;
        font-weight: bold;
    ">
        Purchase
    </button>
</body>
</html>
